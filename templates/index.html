<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Pest Risk Intelligence Platform</title>
  <meta name="description"
    content="Smart Pest Risk Intelligence â€“ Real-time crop protection powered by machine learning. Predict pest risk for any farm condition or city." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet" />

  <!-- Leaflet.js CDN -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET & ROOT TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary: #1B5E20;
      --primary2: #2E7D32;
      --secondary: #43A047;
      --accent: #00C853;
      --warning: #FB8C00;
      --danger: #D32F2F;
      --bg-grad: linear-gradient(135deg, #eef7f0 0%, #f6fbf7 100%);
      --card: rgba(255, 255, 255, 0.75);
      --card-solid: #fff;
      --border: rgba(67, 160, 71, 0.18);
      --border2: rgba(67, 160, 71, 0.1);
      --text: #0d2b0f;
      --text2: #3a5c3c;
      --muted: #7a9e7c;
      --shadow: 0 8px 32px rgba(27, 94, 32, 0.13);
      --shadow2: 0 20px 60px rgba(27, 94, 32, 0.20);
      --shadow3: 0 4px 16px rgba(27, 94, 32, 0.08);
      --r: 16px;
      --r2: 24px;
      --r3: 12px;
      --tr: all 0.35s cubic-bezier(.4, 0, .2, 1);
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', 'Poppins', sans-serif;
      background: var(--bg-grad);
      min-height: 100vh;
      color: var(--text);
      overflow-x: hidden;
    }

    /* decorative blobs */
    body::before {
      content: '';
      position: fixed;
      top: -280px;
      right: -280px;
      width: 660px;
      height: 660px;
      background: radial-gradient(circle, rgba(0, 200, 83, .08) 0%, transparent 65%);
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      bottom: -200px;
      left: -200px;
      width: 520px;
      height: 520px;
      background: radial-gradient(circle, rgba(67, 160, 71, .07) 0%, transparent 65%);
      pointer-events: none;
      z-index: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
      background: linear-gradient(135deg, #0a3d0e 0%, var(--primary) 50%, #1d6b22 100%);
      padding: 0 36px;
      position: sticky;
      top: 0;
      z-index: 300;
      box-shadow: 0 4px 28px rgba(10, 61, 14, .45);
      backdrop-filter: blur(20px);
    }

    .hdr {
      max-width: 1300px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 0;
      gap: 20px;
    }

    .hdr-brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .hdr-logo {
      width: 54px;
      height: 54px;
      background: linear-gradient(135deg, rgba(255, 255, 255, .22), rgba(255, 255, 255, .08));
      border: 1.5px solid rgba(255, 255, 255, .28);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      backdrop-filter: blur(10px);
      flex-shrink: 0;
      box-shadow: 0 4px 16px rgba(0, 0, 0, .15);
    }

    .hdr-title {
      font-family: 'Poppins', sans-serif;
      font-size: 1.35rem;
      font-weight: 800;
      color: #fff;
      letter-spacing: -0.3px;
      line-height: 1.1;
    }

    .hdr-sub {
      font-size: 0.68rem;
      color: rgba(255, 255, 255, .6);
      font-weight: 400;
      margin-top: 3px;
      letter-spacing: 0.5px;
    }

    .hdr-right {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .status-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, .12);
      border: 1px solid rgba(255, 255, 255, .22);
      border-radius: 99px;
      padding: 7px 15px;
      font-size: 0.72rem;
      color: rgba(255, 255, 255, .92);
      font-weight: 600;
      backdrop-filter: blur(10px);
      letter-spacing: 0.2px;
    }

    .blink-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00E676;
      animation: blinkDot 1.8s ease-in-out infinite;
      flex-shrink: 0;
    }

    @keyframes blinkDot {

      0%,
      100% {
        opacity: 1;
        box-shadow: 0 0 0 0 rgba(0, 230, 118, .6);
      }

      50% {
        opacity: .4;
        box-shadow: 0 0 0 5px rgba(0, 230, 118, 0);
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN CONTAINER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    main {
      max-width: 1300px;
      margin: 0 auto;
      padding: 40px 36px 80px;
      position: relative;
      z-index: 1;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE HERO BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero-banner {
      background: linear-gradient(120deg, var(--primary) 0%, var(--secondary) 60%, #00897b 100%);
      border-radius: var(--r2);
      padding: 36px 44px;
      margin-bottom: 36px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      box-shadow: 0 12px 40px rgba(27, 94, 32, .3);
      overflow: hidden;
      position: relative;
    }

    .hero-banner::after {
      content: '';
      position: absolute;
      right: -60px;
      top: -60px;
      width: 280px;
      height: 280px;
      background: rgba(255, 255, 255, .05);
      border-radius: 50%;
    }

    .hero-text h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 1.7rem;
      font-weight: 800;
      color: #fff;
      line-height: 1.2;
    }

    .hero-text p {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, .75);
      margin-top: 8px;
      max-width: 520px;
      line-height: 1.6;
    }

    .hero-badges {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 18px;
    }

    .hero-badge {
      background: rgba(255, 255, 255, .15);
      border: 1px solid rgba(255, 255, 255, .25);
      border-radius: 99px;
      padding: 5px 13px;
      font-size: 0.68rem;
      color: rgba(255, 255, 255, .88);
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .hero-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, .12);
      border: 1px solid rgba(255, 255, 255, .22);
      border-radius: var(--r3);
      padding: 20px 28px;
      text-align: center;
      flex-shrink: 0;
      backdrop-filter: blur(8px);
    }

    .hero-stat-val {
      font-family: 'Poppins', sans-serif;
      font-size: 2rem;
      font-weight: 800;
      color: #fff;
    }

    .hero-stat-label {
      font-size: 0.65rem;
      color: rgba(255, 255, 255, .65);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-top: 3px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION LABEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sec-label {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .sec-icon {
      width: 38px;
      height: 38px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 17px;
      box-shadow: 0 4px 14px rgba(27, 94, 32, .28);
      flex-shrink: 0;
    }

    .sec-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text);
    }

    .sec-sub {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 2px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODE TOGGLE SWITCH
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .mode-toggle-wrap {
      display: flex;
      justify-content: center;
      margin-bottom: 32px;
    }

    .mode-toggle {
      background: rgba(255, 255, 255, .7);
      backdrop-filter: blur(16px);
      border: 1px solid var(--border);
      border-radius: 99px;
      padding: 5px;
      display: flex;
      gap: 4px;
      box-shadow: var(--shadow3);
    }

    .mode-btn {
      padding: 11px 28px;
      border-radius: 99px;
      border: none;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-size: 0.82rem;
      font-weight: 700;
      letter-spacing: 0.2px;
      transition: var(--tr);
      color: var(--muted);
      background: transparent;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      box-shadow: 0 4px 18px rgba(27, 94, 32, .35);
    }

    .mode-btn:not(.active):hover {
      color: var(--primary);
      background: rgba(67, 160, 71, .07);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTROL PANEL (shared card)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .control-panel {
      background: var(--card);
      backdrop-filter: blur(24px);
      border: 1px solid var(--border);
      border-radius: var(--r2);
      box-shadow: var(--shadow2);
      padding: 40px 44px;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
    }

    .control-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent), var(--secondary), var(--primary));
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
    }

    @keyframes shimmer {
      0% {
        background-position: 0% 0%;
      }

      100% {
        background-position: 200% 0%;
      }
    }

    /* MANUAL SECTION */
    #manualSection {
      display: block;
    }

    #citySection {
      display: none;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 28px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--text2);
      text-transform: uppercase;
      letter-spacing: 0.9px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .inp-wrap {
      position: relative;
    }

    .inp-wrap input,
    .inp-wrap select {
      width: 100%;
      padding: 13px 46px 13px 44px;
      border: 1.5px solid var(--border2);
      border-radius: var(--r3);
      font-family: 'Inter', sans-serif;
      font-size: 0.88rem;
      font-weight: 600;
      color: var(--text);
      background: rgba(255, 255, 255, .85);
      transition: var(--tr);
      outline: none;
      appearance: none;
      -webkit-appearance: none;
    }

    .inp-wrap select {
      padding-right: 36px;
    }

    .inp-wrap input:focus,
    .inp-wrap select:focus {
      border-color: var(--secondary);
      background: #fff;
      box-shadow: 0 0 0 3px rgba(67, 160, 71, .15);
    }

    .inp-wrap input::placeholder {
      color: var(--muted);
      font-weight: 400;
    }

    .inp-ico {
      position: absolute;
      left: 13px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
      pointer-events: none;
    }

    .inp-unit {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.62rem;
      font-weight: 700;
      color: var(--muted);
      background: #eef7f0;
      padding: 2px 6px;
      border-radius: 5px;
      pointer-events: none;
    }

    .sel-arr {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--secondary);
      font-size: 13px;
      pointer-events: none;
    }

    .season-row {
      grid-column: 1 / -1;
    }

    /* CITY SECTION */
    .city-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      padding: 12px 0 4px;
    }

    .city-card-inner {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .city-select-label {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--text2);
      text-transform: uppercase;
      letter-spacing: 0.9px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .city-info {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(0, 200, 83, .08);
      border: 1px solid rgba(0, 200, 83, .2);
      border-radius: var(--r3);
      padding: 12px 16px;
      font-size: 0.8rem;
      color: var(--primary2);
      font-weight: 500;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn-run {
      width: 100%;
      padding: 18px 32px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: #fff;
      border: none;
      border-radius: var(--r3);
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.3px;
      cursor: pointer;
      transition: var(--tr);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 6px 24px rgba(27, 94, 32, .4);
      animation: glowPulse 3s ease-in-out infinite;
    }

    @keyframes glowPulse {

      0%,
      100% {
        box-shadow: 0 6px 24px rgba(27, 94, 32, .4), 0 0 0 0 rgba(0, 200, 83, 0);
      }

      50% {
        box-shadow: 0 8px 32px rgba(27, 94, 32, .55), 0 0 22px 5px rgba(0, 200, 83, .2);
      }
    }

    .btn-run::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .18), transparent);
      transition: left 0.6s ease;
    }

    .btn-run:hover::before {
      left: 100%;
    }

    .btn-run:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(27, 94, 32, .55), 0 0 30px 6px rgba(0, 200, 83, .22);
      animation: none;
    }

    .btn-run:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-run.loading {
      pointer-events: none;
      opacity: .86;
      animation: none;
    }

    .spin {
      width: 20px;
      height: 20px;
      border: 2.5px solid rgba(255, 255, 255, .35);
      border-top-color: #fff;
      border-radius: 50%;
      animation: rot .8s linear infinite;
      display: none;
    }

    .btn-run.loading .spin {
      display: block;
    }

    .btn-text-label {
      display: inline;
    }

    .btn-run.loading .btn-text-label {
      opacity: .7;
    }

    @keyframes rot {
      to {
        transform: rotate(360deg);
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESULTS SECTION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .results-section {
      display: none;
      animation: fadeUp .55s cubic-bezier(.4, 0, .2, 1) forwards;
    }

    .results-section.visible {
      display: block;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(28px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    /* â”€â”€â”€ GAUGE CARD â”€â”€â”€ */
    .gauge-card {
      background: var(--card);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      padding: 38px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: var(--tr);
    }

    .gauge-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow2);
    }

    .gauge-label {
      font-size: 0.68rem;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1.1px;
      margin-bottom: 26px;
    }

    /* Semi-circle SVG gauge */
    .gauge-wrap {
      position: relative;
      width: 200px;
      height: 105px;
      margin-bottom: 10px;
    }

    .gauge-svg {
      width: 200px;
      height: 110px;
      overflow: visible;
    }

    /* track arc */
    .gauge-track {
      fill: none;
      stroke: #e8f5e9;
      stroke-width: 16;
      stroke-linecap: round;
    }

    /* colored arc */
    .gauge-arc {
      fill: none;
      stroke-width: 16;
      stroke-linecap: round;
      stroke: var(--secondary);
      transition: stroke-dashoffset 1s cubic-bezier(.4, 0, .2, 1), stroke 0.4s ease;
      /* full circumference of r=80 semicircle â‰ˆ 251.3; half â‰ˆ 251.3 */
    }

    .gauge-needle {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform-origin: bottom center;
      transform: translateX(-50%) rotate(-90deg);
      width: 3px;
      height: 68px;
      background: linear-gradient(to top, var(--primary), transparent);
      border-radius: 3px;
      transition: transform 1s cubic-bezier(.4, 0, .2, 1);
    }

    .gauge-center-dot {
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--primary);
      border: 2px solid #fff;
      box-shadow: var(--shadow3);
    }

    .gauge-ticks {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      top: 0;
      pointer-events: none;
    }

    .gauge-val-display {
      font-family: 'Poppins', sans-serif;
      font-size: 2.2rem;
      font-weight: 900;
      color: var(--text);
      line-height: 1;
      margin-bottom: 5px;
      margin-top: 12px;
      transition: color 0.4s;
    }

    .gauge-val-display.c-low {
      color: var(--secondary);
    }

    .gauge-val-display.c-med {
      color: var(--warning);
    }

    .gauge-val-display.c-high {
      color: var(--danger);
    }

    .gauge-sub-text {
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.9px;
      margin-bottom: 22px;
    }

    /* segmented bar */
    .risk-bar {
      display: flex;
      gap: 6px;
      width: 100%;
      max-width: 220px;
      margin-bottom: 8px;
    }

    .risk-seg {
      flex: 1;
      height: 10px;
      border-radius: 6px;
      background: #e8f5e9;
      transition: all .5s cubic-bezier(.4, 0, .2, 1);
    }

    .risk-seg.act-low {
      background: var(--secondary);
      box-shadow: 0 0 10px rgba(67, 160, 71, .5);
    }

    .risk-seg.act-med {
      background: var(--warning);
      box-shadow: 0 0 10px rgba(251, 140, 0, .5);
    }

    .risk-seg.act-high {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(211, 47, 47, .5);
    }

    .risk-seg.dim-med {
      background: #fff3e0;
    }

    .risk-seg.dim-high {
      background: #ffebee;
    }

    .risk-bar-labels {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 220px;
    }

    .rbl {
      font-size: 0.62rem;
      font-weight: 700;
    }

    .rbl-low {
      color: var(--secondary);
    }

    .rbl-med {
      color: var(--warning);
    }

    .rbl-high {
      color: var(--danger);
    }

    /* â”€â”€â”€ PEST CARD â”€â”€â”€ */
    .pest-card {
      background: var(--card);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      padding: 36px 28px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: var(--tr);
    }

    .pest-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow2);
    }

    .pest-label {
      font-size: 0.68rem;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1.1px;
    }

    .pest-icon-big {
      font-size: 72px;
      line-height: 1;
      margin: 10px 0;
      animation: bounceIn .55s cubic-bezier(.4, 0, .2, 1);
    }

    @keyframes bounceIn {
      0% {
        transform: scale(.4);
        opacity: 0;
      }

      60% {
        transform: scale(1.15);
        opacity: 1;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .pest-name {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text);
      text-align: center;
      line-height: 1.25;
    }

    #diseaseResult {
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--text);
      text-align: center;
    }

    .pest-badge {
      background: rgba(67, 160, 71, .1);
      border: 1px solid rgba(67, 160, 71, .2);
      border-radius: 99px;
      padding: 4px 13px;
      font-size: 0.68rem;
      font-weight: 700;
      color: var(--primary2);
      margin-top: 10px;
    }

    /* hidden ids needed by JS */
    #riskResult {
      display: none;
    }

    /* â”€â”€â”€ ADVICE BOX â”€â”€â”€ */
    #adviceBox {
      padding: 22px 24px 22px 72px;
      border-radius: var(--r);
      font-size: 0.92rem;
      font-weight: 600;
      line-height: 1.6;
      border: 1.5px solid transparent;
      transition: var(--tr);
      position: relative;
      min-height: 70px;
      display: flex;
      align-items: center;
      background: rgba(232, 245, 233, .85);
      border-color: rgba(67, 160, 71, .3);
      color: var(--primary);
    }

    #adviceBox::before {
      content: var(--adv-ico, 'ğŸ’¡');
      position: absolute;
      left: 22px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 26px;
    }

    #adviceBox.high {
      background: rgba(255, 235, 238, .92);
      border-color: rgba(211, 47, 47, .3);
      color: #b71c1c;
      --adv-ico: 'ğŸš¨';
    }

    #adviceBox.medium {
      background: rgba(255, 243, 224, .92);
      border-color: rgba(251, 140, 0, .3);
      color: #e65100;
      --adv-ico: 'âš ï¸';
    }

    #adviceBox.low {
      background: rgba(232, 245, 233, .92);
      border-color: rgba(67, 160, 71, .3);
      color: var(--primary);
      --adv-ico: 'âœ…';
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FOOTER STATS ROW
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 36px;
    }

    .stat-chip {
      background: var(--card);
      backdrop-filter: blur(16px);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 20px 18px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: var(--shadow3);
      transition: var(--tr);
    }

    .stat-chip:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }

    .stat-chip-ico {
      width: 42px;
      height: 42px;
      border-radius: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .stat-chip-ico.g1 {
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    }

    .stat-chip-ico.g2 {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    }

    .stat-chip-ico.g3 {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    }

    .stat-chip-ico.g4 {
      background: linear-gradient(135deg, #f3e5f5, #e1bee7);
    }

    .stat-chip-val {
      font-family: 'Poppins', sans-serif;
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--text);
      line-height: 1;
    }

    .stat-chip-label {
      font-size: 0.67rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.7px;
      margin-top: 3px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FOOTER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    footer {
      text-align: center;
      font-size: 0.72rem;
      color: var(--muted);
      padding-bottom: 40px;
    }

    footer span {
      color: var(--secondary);
      font-weight: 600;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 1024px) {
      .form-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .results-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 700px) {
      header {
        padding: 0 20px;
      }

      main {
        padding: 28px 18px 60px;
      }

      .control-panel {
        padding: 28px 22px;
      }

      .hero-banner {
        flex-direction: column;
        padding: 28px 24px;
      }

      .hero-stat {
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
        padding: 14px 20px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .stats-row {
        grid-template-columns: 1fr 1fr;
      }

      .results-grid {
        grid-template-columns: 1fr;
      }

      .hdr-title {
        font-size: 1.05rem;
      }

      .mode-btn {
        padding: 9px 18px;
        font-size: 0.76rem;
      }
    }

    @media (max-width: 440px) {
      .stats-row {
        grid-template-columns: 1fr;
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       REGIONAL RISK MAP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .map-section {
      margin-bottom: 36px;
    }

    .map-card {
      background: var(--card);
      backdrop-filter: blur(24px);
      border: 1px solid var(--border);
      border-radius: var(--r2);
      box-shadow: var(--shadow2);
      overflow: hidden;
      position: relative;
    }

    .map-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #2196F3, #00C853, #FB8C00, #D32F2F, #00C853, #2196F3);
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
      z-index: 10;
    }

    .map-header {
      padding: 24px 28px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .map-refresh-badge {
      display: flex;
      align-items: center;
      gap: 7px;
      background: rgba(0, 200, 83, .1);
      border: 1px solid rgba(0, 200, 83, .25);
      border-radius: 99px;
      padding: 6px 14px;
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--primary2);
      letter-spacing: 0.3px;
    }

    .map-refresh-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #00C853;
      animation: blinkDot 2s ease-in-out infinite;
      flex-shrink: 0;
    }

    #riskMap {
      height: 450px;
      width: 100%;
      position: relative;
      z-index: 1;
    }

    /* Pulse animation for map markers */
    @keyframes markerPulse {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.85;
      }

      70% {
        transform: translate(-50%, -50%) scale(2.6);
        opacity: 0;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }

    .risk-marker-wrap {
      position: relative;
      width: 28px;
      height: 28px;
    }

    .risk-marker-core {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 3px 14px rgba(0, 0, 0, 0.25);
      z-index: 2;
    }

    .risk-marker-pulse {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      animation: markerPulse 2s ease-out infinite;
      z-index: 1;
    }

    /* Map Legend */
    .map-legend {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(67, 160, 71, 0.15);
      border-radius: 12px;
      padding: 14px 18px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
      min-width: 145px;
    }

    .map-legend h4 {
      font-size: 0.65rem;
      font-weight: 800;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 0.9px;
      margin-bottom: 10px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 9px;
      margin-bottom: 7px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #333;
    }

    .legend-item:last-child {
      margin-bottom: 0;
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      flex-shrink: 0;
      border: 2px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .legend-dot.green {
      background: #43A047;
    }

    .legend-dot.orange {
      background: #FB8C00;
    }

    .legend-dot.red {
      background: #D32F2F;
    }

    @media (max-width: 700px) {
      #riskMap {
        height: 340px;
      }
    }
  </style>
</head>

<body>

  <!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
  <header>
    <div class="hdr">
      <div class="hdr-brand">
        <div class="hdr-logo">ğŸŒ¾</div>
        <div>
          <div class="hdr-title">Smart Pest Risk Intelligence</div>
          <div class="hdr-sub">AI-Powered Crop Protection System</div>
        </div>
      </div>
      <div class="hdr-right">
        <div class="status-chip">
          <span class="blink-dot"></span>
          Model Active
        </div>
      </div>
    </div>
  </header>

  <!-- â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â• -->
  <main>



    <!-- â”€â”€â”€ MODE TOGGLE â”€â”€â”€ -->
    <div class="mode-toggle-wrap">
      <div class="mode-toggle">
        <button class="mode-btn active" id="btnManual" onclick="switchMode('manual')">
          âŒ¨ï¸ Manual Entry
        </button>
        <button class="mode-btn" id="btnCity" onclick="switchMode('city')">
          ğŸŒ Live City Weather
        </button>
      </div>
    </div>

    <!-- â”€â”€â”€ CONTROL CARD â”€â”€â”€ -->
    <div class="control-panel">

      <!-- MANUAL SECTION -->
      <div id="manualSection">
        <div class="sec-label">
          <div class="sec-icon">ğŸŒ¡ï¸</div>
          <div>
            <div class="sec-title">Environmental Parameters</div>
            <div class="sec-sub">Enter field conditions to generate AI risk analysis</div>
          </div>
        </div>

        <div class="form-grid">
          <!-- Temperature -->
          <div class="form-group">
            <label>ğŸŒ¡ï¸ Temperature</label>
            <div class="inp-wrap">
              <span class="inp-ico">ğŸŒ¡ï¸</span>
              <input type="number" id="temp" placeholder="e.g. 28" min="0" max="55" step="0.1" />
              <span class="inp-unit">Â°C</span>
            </div>
          </div>

          <!-- Humidity -->
          <div class="form-group">
            <label>ğŸ’§ Humidity</label>
            <div class="inp-wrap">
              <span class="inp-ico">ğŸ’§</span>
              <input type="number" id="hum" placeholder="e.g. 75" min="0" max="100" step="1" />
              <span class="inp-unit">%</span>
            </div>
          </div>

          <!-- Rainfall -->
          <div class="form-group">
            <label>ğŸŒ§ï¸ Rainfall</label>
            <div class="inp-wrap">
              <span class="inp-ico">ğŸŒ§ï¸</span>
              <input type="number" id="rain" placeholder="e.g. 12" min="0" max="500" step="0.1" />
              <span class="inp-unit">mm</span>
            </div>
          </div>

          <!-- Wind Speed -->
          <div class="form-group">
            <label>ğŸ’¨ Wind Speed</label>
            <div class="inp-wrap">
              <span class="inp-ico">ğŸ’¨</span>
              <input type="number" id="wind" placeholder="e.g. 18" min="0" max="200" step="0.1" />
              <span class="inp-unit">km/h</span>
            </div>
          </div>

          <!-- Season -->
          <div class="form-group season-row">
            <label>ğŸƒ Season</label>
            <div class="inp-wrap sel-wrap" style="position:relative;">
              <span class="inp-ico" style="left:13px;">ğŸƒ</span>
              <select id="season">
                <option value="" disabled selected>Select current seasonâ€¦</option>
                <option value="Summer">â˜€ï¸ Summer</option>
                <option value="Winter">â„ï¸ Winter</option>
                <option value="Monsoon">ğŸŒ§ï¸ Monsoon</option>
              </select>
              <span class="sel-arr">â–¾</span>
            </div>
          </div>
        </div>

        <button class="btn-run" id="runManualBtn" onclick="predictManual()">
          <div class="spin"></div>
          <span>ğŸ§ </span>
          <span class="btn-text-label">Run AI Analysis</span>
        </button>
      </div>

      <!-- CITY SECTION -->
      <div id="citySection">
        <div class="sec-label" style="margin-bottom:28px;">
          <div class="sec-icon">ğŸŒ</div>
          <div>
            <div class="sec-title">Live City Weather Prediction</div>
            <div class="sec-sub">Auto-fetch real-time weather and generate instant pest risk report</div>
          </div>
        </div>

        <div class="city-card">
          <div class="city-card-inner">
            <label class="city-select-label">ğŸ™ï¸ Select City</label>
            <div class="inp-wrap sel-wrap" style="position:relative;">
              <span class="inp-ico">ğŸ™ï¸</span>
              <select id="citySelect">
                <option value="" disabled selected>Choose a cityâ€¦</option>
                <option value="Chennai">Chennai</option>
                <option value="Coimbatore">Coimbatore</option>
                <option value="Madurai">Madurai</option>
                <option value="Bengaluru">Bengaluru</option>
                <option value="Hyderabad">Hyderabad</option>
                <option value="Kochi">Kochi</option>
              </select>
              <span class="sel-arr">â–¾</span>
            </div>

            <div class="city-info">
              <span>ğŸŒ</span>
              Live weather data is fetched from the server for the selected city in real-time.
            </div>
          </div>
        </div>

        <br />
        <button class="btn-run" id="runCityBtn" onclick="predictCity()">
          <div class="spin"></div>
          <span>ğŸŒ¦ï¸</span>
          <span class="btn-text-label">Fetch Live Prediction</span>
        </button>
      </div>

    </div><!-- /control-panel -->

    <!-- â”€â”€â”€ RESULTS â”€â”€â”€ -->
    <div class="results-section" id="resultsSection">

      <!-- Hidden span for JS compatibility -->
      <span id="riskResult"></span>

      <div class="sec-label" style="margin-bottom: 18px;">
        <div class="sec-icon">ğŸ“Š</div>
        <div>
          <div class="sec-title">Analysis Report</div>
          <div class="sec-sub">AI-generated pest risk intelligence</div>
        </div>
      </div>

      <div class="results-grid">

        <!-- Gauge Card -->
        <div class="gauge-card">
          <div class="gauge-label">Pest Risk Level</div>

          <!-- SVG Semicircle Gauge -->
          <div class="gauge-wrap">
            <svg class="gauge-svg" viewBox="0 0 200 110">
              <!-- track -->
              <path class="gauge-track" d="M 16 100 A 84 84 0 0 1 184 100" stroke="#e8f5e9" />
              <!-- arc segments (colored zones) -->
              <path id="gaugeArcLow" d="M 16 100 A 84 84 0 0 1 72 23" fill="none" stroke="#43A047" stroke-width="16"
                stroke-linecap="round" opacity="0.3" />
              <path id="gaugeArcMed" d="M 72 23 A 84 84 0 0 1 128 23" fill="none" stroke="#FB8C00" stroke-width="16"
                stroke-linecap="round" opacity="0.3" />
              <path id="gaugeArcHigh" d="M 128 23 A 84 84 0 0 1 184 100" fill="none" stroke="#D32F2F" stroke-width="16"
                stroke-linecap="round" opacity="0.3" />
              <!-- active arc overlay -->
              <path id="gaugeActive" d="M 16 100 A 84 84 0 0 1 16 100" fill="none" stroke="#43A047" stroke-width="16"
                stroke-linecap="round" style="transition: all 1s cubic-bezier(.4,0,.2,1);" />
            </svg>
            <!-- Needle -->
            <div class="gauge-needle" id="gaugeNeedle"></div>
            <div class="gauge-center-dot"></div>
          </div>

          <div class="gauge-val-display" id="gaugeValDisplay">â€”</div>
          <div class="gauge-sub-text">Risk Classification</div>

          <div class="risk-bar">
            <div class="risk-seg seg-low" id="seg1"></div>
            <div class="risk-seg seg-med" id="seg2"></div>
            <div class="risk-seg seg-high" id="seg3"></div>
          </div>
          <div class="risk-bar-labels">
            <span class="rbl rbl-low">Low</span>
            <span class="rbl rbl-med">Medium</span>
            <span class="rbl rbl-high">High</span>
          </div>
        </div>

        <!-- Pest Card -->
        <div class="pest-card">
          <div class="pest-label">Detected Pest / Disease</div>
          <div class="pest-icon-big" id="pestIconDisplay">ğŸ›</div>
          <div class="pest-name" id="diseaseResult">â€”</div>
          <div class="pest-badge" id="pestBadge" style="display:none;">Identified Threat</div>
        </div>

      </div><!-- /results-grid -->

      <!-- Advisory -->
      <div id="adviceBox" class="low">Awaiting analysisâ€¦</div>

    </div><!-- /results-section -->

    <!-- â”€â”€â”€ REGIONAL RISK MONITORING MAP â”€â”€â”€ -->
    <section class="map-section" aria-label="Regional Risk Monitoring Map">

      <div class="sec-label" style="margin-bottom: 20px;">
        <div class="sec-icon">ğŸ—ºï¸</div>
        <div>
          <div class="sec-title">Regional Risk Monitoring Map</div>
          <div class="sec-sub">Live pest risk levels across South India â€” auto-updates every 60 seconds</div>
        </div>
      </div>

      <div class="map-card">
        <div class="map-header">
          <div style="display:flex; align-items:center; gap:10px;">
            <span style="font-size:1.1rem;">ğŸ“</span>
            <span style="font-size:0.82rem; font-weight:700; color:var(--text2);">South India â€” 6 cities
              monitored</span>
          </div>
          <div class="map-refresh-badge">
            <div class="map-refresh-dot"></div>
            <span id="mapRefreshLabel">Live â€¢ Refreshing every 60s</span>
          </div>
        </div>
        <div id="riskMap"></div>
      </div>

    </section>

  </main>

  <footer>
    <p>Smart Pest Risk Intelligence &copy; 2025 &nbsp;|&nbsp; Powered by <span>Machine Learning</span> &nbsp;|&nbsp;
      Smart Crop Protection</p>
  </footer>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    /* â”€â”€ Mode Switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function switchMode(mode) {
      const manual = document.getElementById('manualSection');
      const city = document.getElementById('citySection');
      const btnM = document.getElementById('btnManual');
      const btnC = document.getElementById('btnCity');

      if (mode === 'manual') {
        manual.style.display = 'block';
        city.style.display = 'none';
        btnM.classList.add('active');
        btnC.classList.remove('active');
      } else {
        manual.style.display = 'none';
        city.style.display = 'block';
        btnC.classList.add('active');
        btnM.classList.remove('active');
      }
    }

    /* â”€â”€ Predict Manual â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function predictManual() {
      const data = {
        temperature: document.getElementById("temp").value,
        humidity: document.getElementById("hum").value,
        rainfall: document.getElementById("rain").value,
        wind_speed: document.getElementById("wind").value,
        season: document.getElementById("season").value
      };

      const btn = document.getElementById('runManualBtn');
      setLoading(btn, true);

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        showResult(result);
      } catch (e) {
        showError();
      } finally {
        setLoading(btn, false);
      }
    }

    /* â”€â”€ Predict City â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function predictCity() {
      const city = document.getElementById("citySelect").value.toLowerCase();
      if (!city) { alert("Please select a city."); return; }

      const btn = document.getElementById('runCityBtn');
      setLoading(btn, true);

      try {
        const res = await fetch(`/predict_city/${city}`);
        const result = await res.json();
        showResult(result);
      } catch (e) {
        showError();
      } finally {
        setLoading(btn, false);
      }
    }

    /* â”€â”€ Show Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showResult(result) {
      // â”€â”€ Hidden span for JS compatibility (required by spec)
      document.getElementById("riskResult").innerText = result.risk;
      document.getElementById("diseaseResult").innerText = result.disease;

      // â”€â”€ Advisory
      const adv = document.getElementById("adviceBox");
      adv.className = '';
      if (result.risk === "High") {
        adv.innerText = "Immediate pesticide spray required";
        adv.classList.add('high');
      } else if (result.risk === "Medium") {
        adv.innerText = "Monitor crop and apply preventive spray";
        adv.classList.add('medium');
      } else {
        adv.innerText = "Crop condition safe";
        adv.classList.add('low');
      }

      // â”€â”€ Gauge
      updateGauge(result.risk);

      // â”€â”€ Pest icon
      const icon = getPestIcon(result.disease);
      document.getElementById('pestIconDisplay').innerText = icon;
      document.getElementById('pestBadge').style.display = 'inline-block';

      // â”€â”€ Show results section with animation
      const sec = document.getElementById('resultsSection');
      sec.classList.remove('visible');
      sec.style.display = 'none';
      void sec.offsetWidth; // reflow
      sec.style.display = 'block';
      sec.classList.add('visible');
      sec.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /* â”€â”€ Gauge Animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function updateGauge(risk) {
      const val = document.getElementById('gaugeValDisplay');
      const needle = document.getElementById('gaugeNeedle');
      const active = document.getElementById('gaugeActive');
      const seg1 = document.getElementById('seg1');
      const seg2 = document.getElementById('seg2');
      const seg3 = document.getElementById('seg3');

      // reset segments
      seg1.className = 'risk-seg';
      seg2.className = 'risk-seg';
      seg3.className = 'risk-seg';

      val.className = 'gauge-val-display';
      val.innerText = risk;

      if (risk === 'High') {
        val.classList.add('c-high');
        needle.style.transform = 'translateX(-50%) rotate(88deg)';
        active.setAttribute('d', 'M 16 100 A 84 84 0 0 1 184 100');
        active.setAttribute('stroke', '#D32F2F');
        seg1.className = 'risk-seg dim-med';
        seg2.className = 'risk-seg dim-med';
        seg3.className = 'risk-seg act-high';
      } else if (risk === 'Medium') {
        val.classList.add('c-med');
        needle.style.transform = 'translateX(-50%) rotate(0deg)';
        active.setAttribute('d', 'M 16 100 A 84 84 0 0 1 100 16');
        active.setAttribute('stroke', '#FB8C00');
        seg1.className = 'risk-seg dim-med';
        seg2.className = 'risk-seg act-med';
        seg3.className = 'risk-seg';
      } else {
        val.classList.add('c-low');
        needle.style.transform = 'translateX(-50%) rotate(-88deg)';
        active.setAttribute('d', 'M 16 100 A 84 84 0 0 1 72 23');
        active.setAttribute('stroke', '#43A047');
        seg1.className = 'risk-seg act-low';
        seg2.className = 'risk-seg';
        seg3.className = 'risk-seg';
      }
    }

    /* â”€â”€ Pest Icon Map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function getPestIcon(disease) {
      if (!disease) return 'ğŸŒ¿';
      const d = disease.toLowerCase();
      if (d.includes('aphid')) return 'ğŸª²';
      if (d.includes('locust')) return 'ğŸ¦—';
      if (d.includes('worm') || d.includes('caterpillar')) return 'ğŸ›';
      if (d.includes('borer')) return 'ğŸ';
      if (d.includes('mite')) return 'ğŸ•·ï¸';
      if (d.includes('thrip')) return 'ğŸ¦Ÿ';
      if (d.includes('whitefly')) return 'ğŸ¦‹';
      if (d.includes('beetle')) return 'ğŸ';
      if (d.includes('fungus') || d.includes('blight') || d.includes('rust')) return 'ğŸ„';
      if (d.includes('mosaic') || d.includes('virus')) return 'ğŸ§¬';
      if (d.includes('insect')) return 'ğŸ¦—';
      return 'ğŸŒ¿';
    }

    /* â”€â”€ Loading helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function setLoading(btn, state) {
      if (state) {
        btn.classList.add('loading');
        btn.querySelector('.btn-text-label').textContent = 'Analyzingâ€¦';
      } else {
        btn.classList.remove('loading');
        const id = btn.id;
        btn.querySelector('.btn-text-label').textContent =
          id === 'runManualBtn' ? 'Run AI Analysis' : 'Fetch Live Prediction';
      }
    }

    /* â”€â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showError() {
      const adv = document.getElementById("adviceBox");
      adv.className = 'high';
      adv.innerText = 'Connection error â€” please check the server and retry.';
      const sec = document.getElementById('resultsSection');
      sec.style.display = 'block';
      sec.classList.add('visible');
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       REGIONAL RISK MONITORING MAP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const MAP_CITIES = [
      { name: 'Chennai', key: 'chennai', lat: 13.0827, lng: 80.2707 },
      { name: 'Coimbatore', key: 'coimbatore', lat: 11.0168, lng: 76.9558 },
      { name: 'Madurai', key: 'madurai', lat: 9.9252, lng: 78.1198 },
      { name: 'Bengaluru', key: 'bengaluru', lat: 12.9716, lng: 77.5946 },
      { name: 'Hyderabad', key: 'hyderabad', lat: 17.3850, lng: 78.4867 },
      { name: 'Kochi', key: 'kochi', lat: 9.9312, lng: 76.2673 }
    ];

    const RISK_COLORS = { Low: '#43A047', Medium: '#FB8C00', High: '#D32F2F' };
    const RISK_BG = { Low: 'rgba(67,160,71,.12)', Medium: 'rgba(251,140,0,.12)', High: 'rgba(211,47,47,.12)' };

    let riskMap = null;
    let mapMarkers = {};
    let mapRefreshTimer = null;

    /* Build a custom Leaflet DivIcon with pulse ring */
    function buildIcon(risk) {
      const col = RISK_COLORS[risk] || '#777';
      return L.divIcon({
        className: '',
        iconSize: [28, 28],
        iconAnchor: [14, 14],
        popupAnchor: [0, -18],
        html: `
          <div class="risk-marker-wrap">
            <div class="risk-marker-pulse" style="background:${col};"></div>
            <div class="risk-marker-core"  style="background:${col};"></div>
          </div>`
      });
    }

    /* Build popup HTML content */
    function buildPopup(data) {
      const col = RISK_COLORS[data.risk] || '#777';
      const bg = RISK_BG[data.risk] || 'rgba(120,120,120,.1)';
      const pest = data.disease || data.pest_type || 'â€”';
      return `
        <div style="font-family:'Inter',sans-serif; min-width:190px; padding:4px 0;">
          <div style="font-family:'Poppins',sans-serif; font-size:1rem; font-weight:800; color:#0d2b0f; margin-bottom:10px;">
            ğŸ“ ${data.city ? data.city.charAt(0).toUpperCase() + data.city.slice(1) : 'â€”'}
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:10px;">
            <div style="background:#eef7f0; border-radius:8px; padding:8px 10px;">
              <div style="font-size:0.6rem; font-weight:700; color:#7a9e7c; text-transform:uppercase; letter-spacing:.7px;">Temp</div>
              <div style="font-size:1rem; font-weight:800; color:#0d2b0f;">${data.temperature != null ? data.temperature + 'Â°C' : 'â€”'}</div>
            </div>
            <div style="background:#eef7f0; border-radius:8px; padding:8px 10px;">
              <div style="font-size:0.6rem; font-weight:700; color:#7a9e7c; text-transform:uppercase; letter-spacing:.7px;">Humidity</div>
              <div style="font-size:1rem; font-weight:800; color:#0d2b0f;">${data.humidity != null ? data.humidity + '%' : 'â€”'}</div>
            </div>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
            <div style="background:${bg}; border:1.5px solid ${col}40; border-radius:8px; padding:8px 10px;">
              <div style="font-size:0.6rem; font-weight:700; color:#7a9e7c; text-transform:uppercase; letter-spacing:.7px;">Risk Level</div>
              <div style="font-size:0.95rem; font-weight:800; color:${col};">${data.risk || 'â€”'}</div>
            </div>
            <div style="background:#eef7f0; border-radius:8px; padding:8px 10px;">
              <div style="font-size:0.6rem; font-weight:700; color:#7a9e7c; text-transform:uppercase; letter-spacing:.7px;">Pest Type</div>
              <div style="font-size:0.78rem; font-weight:700; color:#0d2b0f; word-break:break-word;">${pest}</div>
            </div>
          </div>
        </div>`;
    }

    /* Fetch prediction for one city and update its marker */
    async function fetchCityRisk(cityObj) {
      try {
        const res = await fetch(`/predict_city/${cityObj.key}`);
        const data = await res.json();
        if (data.error) throw new Error(data.error);

        const risk = data.risk || 'Low';

        if (mapMarkers[cityObj.key]) {
          /* update existing marker */
          mapMarkers[cityObj.key].setIcon(buildIcon(risk));
          mapMarkers[cityObj.key].setPopupContent(buildPopup(data));
          mapMarkers[cityObj.key]._riskData = data;
        } else {
          /* create marker for first time */
          const marker = L.marker([cityObj.lat, cityObj.lng], {
            icon: buildIcon(risk),
            title: cityObj.name
          })
            .bindPopup(buildPopup(data), {
              maxWidth: 260,
              className: 'risk-popup'
            })
            .addTo(riskMap);
          marker._riskData = data;
          mapMarkers[cityObj.key] = marker;
        }
      } catch (err) {
        console.warn(`Map: could not fetch risk for ${cityObj.name}`, err);
      }
    }

    /* Refresh all city markers */
    async function refreshAllMarkers() {
      await Promise.all(MAP_CITIES.map(c => fetchCityRisk(c)));
      const now = new Date();
      document.getElementById('mapRefreshLabel').textContent =
        `Live â€¢ Last updated ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
    }

    /* Initialise map once DOM is ready */
    function initRiskMap() {
      riskMap = L.map('riskMap', {
        center: [12.0, 78.5],
        zoom: 6,
        zoomControl: true,
        scrollWheelZoom: false
      });

      /* OpenStreetMap tiles */
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(riskMap);

      /* Legend â€” bottom right */
      const legend = L.control({ position: 'bottomright' });
      legend.onAdd = function () {
        const div = L.DomUtil.create('div', 'map-legend');
        div.innerHTML = `
          <h4>Risk Level</h4>
          <div class="legend-item"><div class="legend-dot green"></div>Safe</div>
          <div class="legend-item"><div class="legend-dot orange"></div>Moderate Risk</div>
          <div class="legend-item"><div class="legend-dot red"></div>High Risk</div>`;
        return div;
      };
      legend.addTo(riskMap);

      /* Initial load */
      refreshAllMarkers();

      /* Auto-refresh every 60 seconds */
      mapRefreshTimer = setInterval(refreshAllMarkers, 60000);
    }

    /* Boot map after page loads */
    window.addEventListener('load', initRiskMap);
  </script>
</body>

</html>